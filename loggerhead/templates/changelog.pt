<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<tal:block define="onload string:sortCollapseElements()">
<html xmlns="http://www.w3.org/1999/xhtml" metal:use-macro="macros/main">
  <head>
    <title metal:fill-slot="title"
           tal:content="string:${branch/friendly_name} : changes">
      ${branch.friendly_name} : changes
    </title>
    <metal:block fill-slot="header-extras">
      <link rel="alternate" type="application/atom+xml"
            tal:attributes="href python:url(['/atom']);
                            title string:RSS feed for ${branch/friendly_name}"
            />

      <script type="text/javascript"
              tal:attributes="src python:tg.url('/static/javascript/collapse.js')">
      </script>
    </metal:block>
  </head>

  <body>

    <h1 style="margin-bottom: 1em" metal:fill-slot="heading">
      <span class="branch-name" tal:content="branch/friendly_name">
        ${branch.friendly_name}
      </span>
      : changes
      <span tal:condition="file_id">
        to
        <span class="filename"
              tal:content="python:history.get_path(revid, file_id)">
          ${history.get_path(revid, file_id)}
        </span>
      </span>
      <span tal:condition="viewing_from">
        from <tal:block content="python:history.get_revno(start_revid)" />
      </span>
      <span tal:condition="query">
        matching <tal:block content="query" />
      </span>
    </h1>

    <div metal:fill-slot="content">

      <span tal:condition="search_failed">
        Sorry, no results found for your search.
      </span>

      <span tal:condition="not:changes">
        No revisions!
      </span>

      <span tal:condition="not:search_failed"
            class="changelog">
        <tal:b content="structure python:collapse_all_button('cl')" />
      </span>

      <table class="log-entries"
             tal:define="subcolspan python:4-bool(all_same_author)">
        <tr class="log-header">
          <th class="revision-number">
            Rev
          </th>
          <th>
          </th>
          <th class="summary">
            Summary
          </th>
          <th tal:condition="not:all_same_author"
              class="author">
            Committer
          </th>
          <th class="date" colspan="2">
            Date
          </th>
        </tr>
        <tal:block tal:repeat="entry changes">
          <a tal:attributes="name string:entry-${entry/revno}" />
          <tr tal:attributes="class string:revision-header parity${entry/parity}">
            <td class="revision-number">
              <a tal:attributes="title python:'Show revision '+history.get_revno(entry.revid);
                                 href  python:url(['/revision', entry.revid])"
                 tal:content="python:util.trunc(entry.revno)">
                text
              </a>
            <td class="expand-button" tal:define="name entry/revno">
              <tal:b content="structure python:collapse_button('cl', entry.revno)" />
            </td>
            <td class="summary">
              <a tal:attributes="title python:'Show revision '+history.get_revno(entry.revid);
                                 href  python:url(['/revision', entry.revid])"
                 tal:content="entry/short_comment">
                text
              </a>
            </td>
            <td tal:condition="not:all_same_author"
                tal:content="python:util.trunc(util.hide_email(entry.author), 20)"
                class="author">
              ${util.trunc(util.hide_email(entry.author), 20)}
            </td>
            <td class="date">
              <tal:b content="python:entry.date.strftime('%Y-%m-%d, %H:%M')" />
              &nbsp;
              (<tal:b content="python:util.ago(entry.date)" />)
            </td>
            <td class="inventory-link">
              <a tal:attributes="href python:url(['/files', entry.revid]);
                                 title string:Files at revision ${entry/revno}">
                files
              </a>
            </td>
            </tr>

          <tr tal:attributes="class string:revision-details-block parity${entry/parity}">
            <td colspan="2">
            </td>
            <td tal:attributes="colspan subcolspan">
              <table tal:attributes="class string:revision-details hidden-details collapse-cl-${entry/revno}-content">
                <tr tal:condition="python:len(entry.merge_points) > 0">
                  <th class="children">
                    merged in:
                  </th>
                  <td class="children">
                    <span tal:repeat="child entry/merge_points">
                      <a title="Show history"
                         tal:attributes="href python:url(['/changes'], start_revid=child.revid)"
                         tal:content="python:revno_with_nick(child)">
                        class="revlink">
                        ${text}
                      </a>
                      <br />
                    </span>
                  </td>
                </tr>
                <tr tal:condition="python:len(entry.parents) > 1">
                  <th class="parents">
                    merged from:
                  </th>
                  <td class="parents">
                    <span tal:repeat="parent entry/parents">
                      <span tal:condition="python:parent.revid != entry.parents[0].revid">
                        <a title="Show history"
                           tal:attributes="href python:url(['/changes'], start_revid=parent.revid)"
                           tal:content="python:revno_with_nick(parent)">
                          class="revlink">
                          ${text}
                        </a>
                        <br />
                      </span>
                    </span>
                  </td>
                </tr>
                <tr tal:condition="all_same_author">
                  <th class="author">
                    committed by:
                  </th>
                  <td class="author" tal:content="python:util.hide_email(entry.author)">
                    ${util.hide_email(entry.author)}
                  </td>
                </tr>
                <tr>
                  <th class="description">
                    description:
                  </th>
                  <td class="description">
                    <tal:block tal:repeat="line entry/comment_clean">
                      <tal:block content="structure line" />
                      <br />
                    </tal:block>
                  </td>
                </tr>
                <tal:block content="structure python:file_change_summary(url, entry, modified_file_link_log)" />
              </table>
            </td>
          </tr>
          </tal:block>
        </table>

        <div tal:condition="python:navigation.prev_page_revid or navigation.next_page_revid"
             class="bar">
          <table>
            <tr>
              <td class="buttons">
                <a tal:condition="navigation/prev_page_revid"
                   tal:attributes="href navigation/prev_page_url">
                  &lt;&lt; page
                </a>
	      </td>
 	      <td class="rbuttons" align="right">
                <a tal:condition="navigation/next_page_revid"
                   tal:attributes="href navigation/next_page_url">
                  page &gt;&gt;
                </a>
 	      </td>
 	    </tr>
          </table>
        </div>
    </div>
  </body>
</html>
</tal:block>
