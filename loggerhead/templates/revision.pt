<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<tal:block define="onload string:load()">
  <html xmlns="http://www.w3.org/1999/xhtml" metal:use-macro="macros/main">
    <head>
      <title metal:fill-slot="title"
             tal:content="string:${branch/friendly_name} : revision ${change/revno}">
        ${branch.friendly_name} : revision ${change.revno}
      </title>

      <metal:block fill-slot="header_extras">
        <script type="text/javascript"
                tal:attributes="src python:tg.url('/static/javascript/collapse.js')">
        </script>
        <link rel="stylesheet" type="text/css" media="all"
              tal:attributes="href python:tg.url('/static/css/diff.css')"/>
      </metal:block>
    </head>

    <body>

      <tal:block metal:fill-slot="heading">
        <h1><tal:block content="branch/friendly_name"></tal:block><span>: <tal:revno content="change/revno"></tal:revno></span></h1>
        <ul id="submenuTabs">
            <li id="inicio"><a tal:attributes="href python:url(['/files', change.revno]); 
                                               title string:browse files at revision ${change/revno}"
                               tal:content="string:browse files at revision ${change/revno}"></a></li>
            <li tal:condition="python:remember != change.revno">
                <a tal:attributes="href python:url(['/revision', change.revno], remember=change.revno, compare_revid=None); 
                                   title string:Compare with another revision"
                   tal:content="string:Compare with another revision"></a></li>       
            <li id="final"><a tal:attributes="href python:url(['/changes', change.revno]); 
                                  title string:view history from revision ${change/revno}"
                  tal:content="string:view history from revision ${change/revno}"></a></li>
        </ul>
        
        <tal:revision-info replace="structure python:revisioninfo(url, branch, change, modified_file_link_rev)" />

        <p class="expand"><a href="#"><img tal:attributes="src python:tg.url('/static/images/treeCollapsed.png')" 
                             alt="collapse all" /> collapse all</a></p>
                        <p class="codin"><a href="#"><img tal:attributes="src python:tg.url('/static/images/newCode.gif')" 
                           alt="added" /> added</a></p>
        <p class="codin"><a href="#"><img tal:attributes="src python:tg.url('/static/images/deleteCode.gif')" alt="removed" /> removed</a></p>
        <div class="clear"><!-- --></div>
        <tal:compare-to condition="python:compare_revid is not None">
          (compared to revision <tal:b content="python:history.get_revno(compare_revid)" />)
        </tal:compare-to>
      </tal:block>

      <div metal:fill-slot="content">
        <div class="links">
          <div tal:condition="python:compare_revid is not None" >
            <b>&#8594;</b>
            <a tal:attributes="href python:branch.url(['/bundle', revid, compare_revid, 'bundle.txt'])">
                download bundle from <tal:b content="python:history.get_revno(compare_revid)" /> to <tal:b content="change/revno" />
            </a>
          </div>
          <div tal:condition="python:(remember is not None) and (compare_revid is None) and (change.revno != remember)" >
            <b>&#8594;</b>
            <a tal:attributes="href python:url(['/revision', revid], compare_revid=remember)">
              compare with revision <tal:b content="python:history.get_revno(remember)" />
            </a>
          </div>
          <tal:we-are-comparing condition="python:compare_revid is not None">
            <div>
              <b>&#8594;</b>
              <a tal:attributes="href python:url([ '/revision', compare_revid ], remember=revid, compare_revid=revid)">
                reverse the comparison (<tal:b content="change/revno" /> to <tal:b content="python:history.get_revno(compare_revid)" />)
              </a>
            </div>
            <div>
              <b>&#8594;</b>
              <a tal:attributes="href python:url(['/revision', revid], remember=None, compare_revid=None)">
                stop comparing with revision <tal:b content="python:history.get_revno(compare_revid)" />
              </a>
            </div>
          </tal:we-are-comparing>
        </div>

        <div class="diff"
             tal:condition="change/changes/modified"
             tal:define="uniqs python:{}">

        <div class="lineCode">
        	<span>&nbsp;</span>
            <span>from loggerhead import util</span>
            <span>&nbsp;</span>
            <span>&nbsp;</span>
            <span>&nbsp;</span>
            <span>&nbsp;</span>
            <span>class RevisionUI (object):</span>
            <span>&nbsp;</span>
            <span class="removecode">&nbsp;&nbsp;&nbsp;&nbsp;def __init__(self, branch):</span>
        </div>
       	<div class="lineNumber">
        	<span><strong>old</strong></span>
            <span>25</span>
            <span>26</span>
            <span>&nbsp;</span>
            <span>&nbsp;</span>
            <span>&nbsp;</span>
            <span>27</span>
            <span>28</span>
            <span>29</span>
        </div>
        <div class="lineCode">
        	<span>&nbsp;</span>
            <span>from loggerhead import util</span>
            <span>&nbsp;</span>
            <span>&nbsp;</span>
            <span>&nbsp;</span>
            <span>&nbsp;</span>
            <span>class RevisionUI (object):</span>
            <span>&nbsp;</span>
            <span class="addcode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def __init__(self, branch):</span>
        </div>        
        <div class="clear"><!-- --></div>
          <!-- ! side-by-side diff -->
          <tal:block repeat="item change/changes/modified">

              <tal:u define="u python:util.uniq(uniqs, item.file_id)">
                      <div class="diffBox"><a href="#"><img tal:attributes="src python:tg.url('/static/images/treeCollapsed.png');
                                                                            title string:Annotate ${item/filename}" /></a>
                              <a tal:attributes="href python:url(['/annotate', change.revno], clear=1, file_id=item.file_id)" 
                                 tal:content="item/filename"></a></div>
               <tal:block repeat="chunk item/sbs_chunks">
                 <tal:block repeat="line chunk/diff">

                    <tal:block condition="line/old_lineno">
                        <div tal:content="line/old_lineno"></div>
                        <div tal:content="line/old_line"></div>
                    </tal:block>

                    <tal:block condition="not:line/old_lineno">
                        <div tal:content="line/old_lineno">&nbsp;</div>
                        <div tal:content="line/old_line"></div>
                    </tal:block>

                    <tal:block condition="line/new_lineno">
                        <div tal:content="line/new_lineno"></div>
                        <div tal:content="line/new_line"></div>
                    </tal:block>

                    <tal:block condition="not:line/new_lineno">
                        <div tal:content="line/new_lineno">&nbsp;</div>
                        <div tal:content="line/new_line"></div>
                    </tal:block>

                 </tal:block>
               </tal:block>
              </tal:u>
            </tal:block>

        </div>

        <div tal:condition="python:navigation.prev_page_revid or navigation.next_page_revid"
             class="bar">
          <table>
            <tr>
              <td class="buttons">
                <a tal:condition="navigation/prev_page_revid"
                   tal:attributes="href navigation/prev_page_url">
                  &lt; revision
                  <tal:r content="python:history.get_revno(navigation.prev_page_revid)" />
                </a>
	      </td>
 	      <td class="rbuttons" align="right">
                <a tal:condition="navigation/next_page_revid"
                   tal:attributes="href navigation/next_page_url">
                  revision
                  <tal:r content="python:history.get_revno(navigation.next_page_revid)" />
                  &gt;
                </a>
 	      </td>
 	    </tr>
          </table>
        </div>
      </div>
    </body>
  </html>
</tal:block>
