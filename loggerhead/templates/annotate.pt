<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <title>
      <tal:branch-name content="branch/friendly_name">
        ${branch.friendly_name} 
      </tal:branch-name>
      : contents of 
      <tal:path content="path">
        ${path}
      </tal:path>
      at revision
      <tal:revno content="change/revno">
        ${change.revno}
      </tal:revno>
    </title>
    <link rel="stylesheet"
          tal:attributes="href python:tg.url('/static/css/zptstyle.css')" />
  </head>

  <body>
    <div class="bar">
      <form tal:attributes="action python:branch.url('/changes', start_revid=getattr(navigation, 'start_revid', None), file_id=getattr(navigation, 'file_id', None))">
        <table>
          <tr>
            <td>
              <span class="buttons">
                <a href="${branch.url('/changes', **util.get_context(clear=1))}"> changes </a>
                <a href="${branch.url('/files', **util.get_context(clear=1))}"> files </a>
                <span class="search">
                  search: <input type="text" name="q" />
                </span>
              </span>
            </td>
            <td align="right" tal:condition="navigation/revid_list|nothing">
              <span tal:condition="navigation/feed" class="rbuttons feed">
                <a href="${branch.url('/atom')}">
                  <img src="${tg.url('/static/images/feed-icon-16x16.gif')}" />
                </a>
              </span>
              <span class="navbuttons">
                <span tal:condition="navigation/prev_page_revid">
                  <a href="${navigation.prev_page_url}" title="Previous page"> &#171; </a>
                </span>
                <span tal:condition="python:not navigation.prev_page_revid"> &#171; </span>
                revision ${history.get_revno(revid)}
                (<span tal:condition="python:navigation.pagesize > 1">page </span>
                ${navigation.page_position} / ${navigation.page_count})
                <span tal:condition="navigation/next_page_revid">
                  <a href="${navigation.next_page_url}" title="Next page"> &#187; </a>
                </span>
                <span tal:condition="python:not navigation.next_page_revid"> &#187; </span>
              </span>
            </td>
          </tr>
        </table>
      </form>
    </div>

    <h1>
      <span class="branch-name" tal:content="branch/friendly_name">
        ${branch.friendly_name}
      </span>
      :
      <span class="annotate-path" tal:content="path">
        ${path}
      </span>
      (revision <tal:revno content="change/revno">${change.revno}</tal:revno>)
    </h1>
    <div class="links">
      <div>
        <b>&#8594;</b>
        <a href="${branch.url([ '/files', revid ], **util.get_context(clear=1))}">
          browse files
        </a>
      </div>
      <div>
        <b>&#8594;</b>
        <a href="${branch.url('/revision', **util.get_context(clear=1, start_revid=revid))}">
          view revision
        </a>
      </div>
      <div>
        <b>&#8594;</b>
        <a href="${branch.url('/changes', **util.get_context(clear=1, start_revid=revid, file_id=file_id))}"> view changes to this file </a>
      </div>
      <div>
        <b>&#8594;</b>
        <a href="${branch.url([ '/download', revid, file_id, filename ])}"> download file </a>
      </div>
    </div>

    <div class="annotate">
      <table>
        <tr>
          <th class="lineno"> Line# </th>
          <th class="revision"> Revision </th>
          <th class="text"> Contents </th>
        </tr>

        <tr tal:repeat="line contents"
            tal:attributes="class string:parity${line/parity}">
          <td tal:attributes="class string:lineno ${line/status}">
            <a tal:attributes="name string:L${line/lineno}"
               tal:content="line/lineno">
              ${line.lineno}
            </a>
          </td>
          <td tal:attributes="class string:revno ${line/status}">
            <a tal:condition="python:line.status=='changed'"
               tal:content="python:util.trunc(line.change.revno)"
               tal:attributes="href python:branch.url('/revision', **util.get_context(clear=1, start_revid=line.change.revid, file_id=file_id));
                               title python:'%s by %s, on %s (%s)'%(line.change.revno, util.hide_email(line.change.author), line.change.date.strftime('%d %b %Y %H:%M'), util.ago(line.change.date))">

              ${util.trunc(line.change.revno)}
            </a>
          </td>
          <td tal:attributes="class string:text ${line/status}"
              tal:content="line/text">
            ${line.text}
          </td>
        </tr>
      </table>
    </div>
  </body>
</html>
